<section class="screen">
    <div class="container-custom">
        <section class="grid w-full grid-cols-2">
            <div>
                <div class="flex flex-row gap-2">
                    <h4>
                        {{pageTitle}}
                    </h4>
                    <i class="pi pi-pencil pt-2 cursor-pointer" (click)="openProjectInfos()"></i>
                </div>
                <div class="pt-2">
                    <p class="small-text text-gray-600">Aqui ficarão centralizadas todas as tarefas do projeto, você
                        poderá
                        filtrar,</p>
                    <p class="small-text text-gray-600"> ordenar e criar novas tarefas. Gerenciando o seu tempo e
                        registrando cada etapa.</p>
                </div>
            </div>
        </section>

        <section class="menu">
            <div>
                <ng-container *ngFor="let item of menuItems">
                    <label [ngClass]="clicked === item.id ? 'clicked' : 'default'" class="medium-text">
                        <i class="{{ item.iconClass }}" style="font-size: 1.4rem"></i>
                        <button (click)="changePreviewMode(item.id)">
                            {{ item.label }}
                        </button>
                    </label>
                </ng-container>
            </div>

            <div class="config-menu medium-text">
                <button *ngIf="!searchBarOpen" (click)="toggleSearchBar()">
                    <i class="pi pi-search"></i>
                </button>

                <div class="search " *ngIf="searchBarOpen">
                    <input type="text" placeholder="Pesquise por uma tarefa..." [(ngModel)]="query">
                    <i class="pi pi-times cursor-pointer" (click)="toggleSearchBar()"></i>
                </div>

                <ng-container *ngFor="let item of configItems">
                    <button class="config-buttons" (click)="item.click()">
                        <i [style.transform]="item.id === 'order' ? 'rotate(90deg)' : 'rotate(0deg)'"
                            class="{{ item.iconClass }}"></i>
                    </button>
                </ng-container>

                <button class="config-buttons" *ngIf="tasksToReview.length > 0" (click)="toggleReview()">
                    <i class="pi pi-check-square" pBadge value={{badgeNumber}}></i>
                </button>

                <button class="properties-button" (click)="openPropertiesModal()" *ngIf="clicked !== 'Mural'">
                    <i class="pi pi-tags"></i>
                    Propriedades
                </button>
                <button *ngIf="!isMuralPage; else buttonMural" class="create" (click)="createTask()"
                    [disabled]="!canCreate" [ngClass]="canCreate ? 'opacity-100' : 'opacity-20'">
                    <i class="pi pi-plus-circle"></i>
                    Nova tarefa
                </button>
                <ng-template #buttonMural>
                    <button class="create" (click)="createNote()">
                        <i class="pi pi-plus-circle"></i>
                        Nova nota
                    </button>
                </ng-template>
            </div>
        </section>

        <section class="filter-settings regular-text mb-2">
            <ng-container *ngIf="filterOpen || orderOpen">
                <div *ngIf="orderOpen">
                    <p>Ordenar por </p>
                    <p-cascadeSelect 
                            [(ngModel)]="orderParams" 
                            [options]="orderOptions" 
                            optionLabel="name" 
                            optionGroupLabel="name" 
                            [optionGroupChildren]="['values']" 
                            [style]="{ minWidth: '13rem' }" 
                            placeholder="Selecione"
                            (ngModelChange)="updateOrderType($event)"
                        >
                        <ng-template pTemplate="option" let-option>
                            <div>
                                <p>{{option.name}}</p>
                            </div>
                        </ng-template>

                    </p-cascadeSelect>
                </div>
                <div *ngIf="filterOpen">
                    <p>Filtrar por </p>
                    <p-cascadeSelect [(ngModel)]="selectedStatusFilter"  
                        [options]="filterOptions" 
                        optionLabel="name" 
                        optionGroupLabel="name" 
                        [optionGroupChildren]="['values']" 
                        [style]="{ minWidth: '13rem' }" 
                        placeholder="Selecione"
                    >
                        <ng-template let-option pTemplate="option">
                            <div *ngIf="option.name !== 'TEXT' && option.name !== 'DATE' && option.name !== 'NUMBER'">
                                {{option.name}}
                            </div>
                            <div *ngIf="option.name === 'TEXT'">
                                <input 
                                    pInputText 
                                    [(ngModel)]="simplePropertyFilter.value" 
                                    type="text" 
                                    placeholder="Filtre por texto" 
                                    (click)="$event.stopPropagation()"
                                    (ngModelChange)="updateFilterParams($event, option)"
                                >
                            </div>
                            <div *ngIf="option.name === 'NUMBER'">
                                <p-inputNumber 
                                    [(ngModel)]="simplePropertyFilter.value" 
                                    placeholder="Filtre por número"
                                    (click)="$event.stopPropagation()"
                                    (ngModelChange)="updateFilterParams($event, option)"
                                ></p-inputNumber>
                            </div>
                        </ng-template>
                    </p-cascadeSelect>
                </div>
            </ng-container>
        </section>

        <section class="router" *ngIf="renderProject | async">
            <app-kanban 
                *ngIf="clicked  === 'Kanban'" 
                [project]="project" 
                [nameFilter]="query" 
                [statusFilter]="selectedStatusFilter"
                [permissions]="permissions"
                [orderParams]="orderParams"
                (openTaskDetails)="changeModalTaskState(true, $event)" 
            ></app-kanban>

            <app-list 
                *ngIf="clicked  === 'List'" 
                [project]="project" 
                [queryFilter]="query" 
                [statusFilter]="selectedStatusFilter" 
                [orderParams]="orderParams"
                [simplePropertyFilter]="simplePropertyFilter"
                [permissions]="permissions"
                (openTaskDetails)="changeModalTaskState(true, $event)"
            ></app-list> 

            <app-calendar 
                *ngIf="clicked  === 'Calendar'" 
                [project]="project"
                [nameFilter]="query" 
                [statusFilter]="selectedStatusFilter"
                [orderParams]="orderParams"
                [permissions]="permissions"
                (openTaskDetails)="changeModalTaskState(true, $event)" 
            ></app-calendar>

            <app-mural 
                *ngIf="clicked  === 'Mural'" 
                [project]="project"
            ></app-mural>
        </section>

    </div>
</section>

<app-modal-properties 
    *ngIf="propertiesOpen" 
    [project]="project"
    [height]="'600px'"
    [width]="'450px'" 
    (close)="openPropertiesModal()"
    (changeProjectSettings)="changeProject($event)" 
></app-modal-properties> 

<app-task 
    *ngIf="taskOpen"
    [task]="taskOpenObject" 
    [project]="project" 
    [permissions]="permissions"
    (changes)="updateProjectByTaskChanges($event)" 
    (close)="changeModalTaskState(false, taskOpenObject)" 
></app-task>

<app-review-task 
    *ngIf="taskReview" 
    [tasksToReview]="tasksToReview" 
    (toggleReview)="toggleReview()"
    (closeModal)="updateTasksToReview($event)"  
></app-review-task>

<app-create-team-project 
    *ngIf="openModalProject" 
    [project]="project" 
    [team]="project.team"
    [typeString]="'projectInfo'" 
    (close)="openProjectInfos()"
></app-create-team-project>